# $Header: /cvs/fluid/fluid/code/fluid/parse/GNUmakefile,v 1.11 2003/01/31 23:32:47 boyland Exp $
# Makefile for ./code/fluid/parse
HERE=${FLUIDTOP}/code/fluid/parse
SUBDIRS= 
JAVASRC=	ASCII_CharStream.java \
		ASCII_UCodeESC_CharStream.java \
		DisplayJJNode.java \
		JJNode.java \
		JJOperator.java \
		Node.java \
		ParseError.java \
		ParseException.java \
		Token.java \
		TokenMgrError.java

OPSRC=		Ellipsis.op 

SOURCE= ${OPSRC} header header.html

GENJAVASRC= ${OPSRC:.op=.java} LoadParseOp.java

GENJAVAOBJ= ${GENJAVASRC:.java=.class}

CREATEOPFLAGS=	-header=header \
		-nodetype=JavaNode \
		-optype=JavaOperator \
		-unparse=true \
		-unparsetype=JavaUnparser \
		Info:String \
		DimInfo:int \
		Modifiers:int \
		Names:IRSequence \
		Op:JavaOperator \
		Code:Object \
		ConstantNode:IRNode \
		ConstantInt:int 

DOCOPFLAGS=	-package=fluid.java.operator \
		-header=header.html \
		-start=CompilationUnit \

OBSOLETE= TreeChanged.java package.html

include ${FLUIDTOP}/lib/make/define.mk
include ${FLUIDTOP}/lib/make/rule.mk

.PHONY: all
all : ${GENJAVAOBJ} ${JAVAOBJ}

doc : ${GENJAVASRC} package.html

ant : ${GENJAVASRC}

package.html : ${DOCOP} ${OPSRC} header.html
	${LOCALBIN}/perl ${DOCOP} ${DOCOPFLAGS} ${OPSRC} > /tmp/doc.html
	mv /tmp/doc.html package.html

${GENJAVASRC} : header

${GENJAVAOBJ} : ${GENJAVASRC} ${JAVASRC}
	${JAVAC} ${GENJAVASRC} ${JAVASRC}

LoadParseOp.java : GNUmakefile
	echo "// Generated by GNUmakefile.  Do not edit." > $@
	echo "package fluid.parse;" >> $@
	echo "public class LoadParseOp {" >> $@
	for name in ${OPSRC:%.op=%}; do \
	  echo "  private static $$name x$$name = $$name.prototype;" >> $@; \
	done
	echo "}" >> $@
